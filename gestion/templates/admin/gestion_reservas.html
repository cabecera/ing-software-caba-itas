{% extends 'base.html' %}

{% block title %}Gestión de Reservas - Las Cabañitas{% endblock %}

{% block content %}
<h1 class="page-title">Gestión de Reservas</h1>

<div class="mb-20">
    <form method="get" class="inline-block-form">
        <select name="estado" onchange="this.form.submit()">
            <option value="">Todos los estados</option>
            <option value="pendiente" {% if estado_filtro == 'pendiente' %}selected{% endif %}>Pendiente</option>
            <option value="confirmada" {% if estado_filtro == 'confirmada' %}selected{% endif %}>Confirmada</option>
            <option value="cancelada" {% if estado_filtro == 'cancelada' %}selected{% endif %}>Cancelada</option>
            <option value="completada" {% if estado_filtro == 'completada' %}selected{% endif %}>Completada</option>
        </select>
    </form>
</div>

{% if reservas %}
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Cliente</th>
                <th>Cabaña</th>
                <th>Fecha Inicio</th>
                <th>Fecha Fin</th>
                <th>Personas</th>
                <th>Monto</th>
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for reserva in reservas %}
            <tr>
                <td>#{{ reserva.idReserva }}</td>
                <td>{{ reserva.cliente.nombre }}</td>
                <td>{{ reserva.cabaña.nombre }}</td>
                <td>{{ reserva.fechaInicio }}</td>
                <td>{{ reserva.fechaFin }}</td>
                <td>{{ reserva.numPersonas }}</td>
                <td>${{ reserva.montoCotizado }}</td>
                <td>{{ reserva.get_estado_display }}</td>
                <td>
                    {% if reserva.estado == 'pendiente' %}
                        <a href="{% url 'aprobar_reserva' reserva.idReserva %}" class="btn btn-success">Aprobar</a>
                        <a href="{% url 'cancelar_reserva' reserva.idReserva %}" class="btn btn-danger">Cancelar</a>
                    {% elif reserva.estado == 'confirmada' %}
                        <a href="{% url 'cancelar_reserva' reserva.idReserva %}" class="btn btn-danger">Cancelar</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <div class="card">
        <p>No hay reservas con el filtro seleccionado.</p>
    </div>
{% endif %}

<div class="mt-30">
    <a href="{% url 'dashboard_admin' %}" class="btn">Volver al Dashboard</a>
</div>
{% endblock %}

